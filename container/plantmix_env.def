Bootstrap: localimage
From: miniconda3_py37_4.11.0.sif
# on part d'un conteneur pré-construit avec miniconda3 et python 3.7

%environment
    export LC_ALL=C
    export LC_NUMERIC=en_GB.UTF-8

%runscript
    # Execute script python
    python "$@"

%post
	apt update
	apt upgrade -y
	DEBIAN_FRONTEND=noninteractive TZ=Etc/UTC apt install -y tzdata

	apt install -y build-essential wget bzip2 unzip git gfortran freeglut3-dev libxext-dev libxrender-dev libglib2.0-0 libqhull-dev

    # installation des dépendances
	wget https://raw.githubusercontent.com/mwoussen/lightvegemanager/master/container/spec-openalea_py37.txt
	conda install --file spec-openalea_py37.txt
	
	# modification de caribu à partir fork
	wget https://raw.githubusercontent.com/mwoussen/caribu/master/src/alinea/caribu/CaribuScene.py
	mv CaribuScene.py /opt/miniconda/lib/python3.7/site-packages/alinea.caribu-8.0.7-py3.7.egg/alinea/caribu/
	wget https://raw.githubusercontent.com/mwoussen/caribu/master/src/alinea/caribu/caribu_shell.py
	mv caribu_shell.py /opt/miniconda/lib/python3.7/site-packages/alinea.caribu-8.0.7-py3.7.egg/alinea/caribu/

    # installe adel (requis par WheatFspm)
    wget https://github.com/rbarillot/adel/archive/python3.zip
    unzip python3.zip && cd adel-python3
    python setup.py develop
    cd ..
    rm python3.zip

    # installe Wheat-Fspm
    git clone --recurse-submodules https://github.com/openalea-incubator/WheatFspm.git
    cd WheatFspm
    git submodule update --remote
    python setup.py develop
    cd ..

	# installe l-egume
	git clone -b Develop https://github.com/glouarn/l-egume.git
    cd l-egume
	python setup.py develop
    cd ..

	# installe PyRATP
	git clone https://github.com/mwoussen/PyRATP.git
	cd PyRATP
	make
	make clean
	cd ..


