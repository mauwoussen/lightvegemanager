Bootstrap: localimage
From: miniconda3_py37_4.11.0.sif
# on part d'un conteneur pré-construit avec miniconda3 et python 3.7

%environment
    export LC_ALL=C
    export LC_NUMERIC=en_GB.UTF-8

%runscript
    # Execute script python
    python "$@"

%post
	apt update
	DEBIAN_FRONTEND=noninteractive TZ=Etc/UTC apt install -y tzdata

	apt install -y build-essential wget bzip2 unzip git gfortran freeglut3-dev libxext-dev libxrender-dev libglib2.0-0 libqhull-dev

    # installation des dépendances
    conda install python=3.7 \
                    openalea.mtg=2.0.5 openalea.plantgl=3.14.1 openalea.lpy=3.9.2 alinea.caribu=8.0.7 alinea.astk=2.1.0 xlrd=2.0.1\
                     coverage=6.3 nose=1.3.7 sphinx=4.4.0 statsmodels=0.13.1 numpy=1.20.3 scipy=1.7.3 pandas=1.3.4 progressbar2=3.37.1\
                      -c conda-forge -c fredboudon

    # installe adel (requis par WheatFspm)
    wget https://github.com/rbarillot/adel/archive/python3.zip
    unzip python3.zip && cd adel-python3
    python setup.py develop
    cd -
    rm python3.zip

    # installe Wheat-Fspm
    git clone --recurse-submodules https://github.com/openalea-incubator/WheatFspm.git
    cd WheatFspm
    git submodule update --remote
    python setup.py develop
    cd ..

	# installe l-egume
	git clone -b Develop https://github.com/glouarn/l-egume.git
    cd l-egume
	python setup.py develop
    cd ..

	# install PyRATP_Mobidiv
	git clone git@github.com:mwoussen/PyRATP_MobiDiv.git
	cd PyRATP_MobiDiv
	make
	make clean
	cd ..

